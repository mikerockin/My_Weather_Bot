name: Deploy to PythonAnywhere

on:
  push:
    branches:
      - main  

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Deploy to PythonAnywhere
        env:
          PYTHONANYWHERE_USERNAME: ${{ secrets.PYTHONANYWHERE_USERNAME }}
          PYTHONANYWHERE_API_TOKEN: ${{ secrets.PYTHONANYWHERE_API_TOKEN }}
        run: |
          import requests
          username = 'PYTHONANYWHERE_USERNAME'
          token = 'PYTHONANYWHERE_API_TOKEN'

          response = requests.get(
          'https://www.pythonanywhere.com/api/v0/user/{username}/cpu/'.format(
           username=username
          ),
            headers={'Authorization': 'Token {token}'.format(token=token)}
          )
          if response.status_code == 200:
          print('CPU quota info:')
           print(response.content)
          else:
              print('Got unexpected status code {}: {!r}'.format(response.status_code, response.content))


